
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/newscripts/Main/Touch.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '603deKgw9hLr5SmNx2mpjce', 'Touch');
// newscripts/Main/Touch.js

"use strict";

var _require = require('console'),
    debug = _require.debug;

var _require2 = require('../UIHelp'),
    UIHelp = _require2.UIHelp;

cc.Class({
  "extends": cc.Component,
  properties: {},
  // LIFE-CYCLE CALLBACKS:
  onLoad: function onLoad() {
    this.animal = null;
  },
  start: function start() {
    this.node.on(cc.Node.EventType.TOUCH_START, function (event) {
      console.log('TOUCH_START');
      this.pos = event.getLocation();
      console.log(this.pos, 'this.pos');
      this.pos = this.node.convertToNodeSpace(this.pos);
      this.pos = this.selectPos(this.pos);
      console.log(this.pos, 'this.pos');
      var animal = cc.ZL.animMgr.animalArray[this.pos.y][this.pos.x];

      if (gamedata.is_prop == 0) {
        //普通操作
        this.pos1 = event.getLocation();
        cc.ZL.musicMgr.MyplayMusic(0, false); //播放点击音效

        cc.ZL.animMgr.selectFirstAnimal(this.pos);
      } else if (gamedata.is_prop == 1) {
        //1小木槌
        this.DaoJuChui(animal); // animal.clear();
        // cc.ZL.PropMgr.propFinished(1);
        // cc.ZL.animMgr.NewFilled();
      } else if (gamedata.is_prop == 2) {
        //2爆弹
        animal.clearType = 3;
        animal.clear();
        setTimeout(function () {
          cc.ZL.animMgr.NewFilled();
        }, comeInfo.animalClearTime * 1000);
        cc.ZL.PropMgr.propFinished(2);
      } else if (gamedata.is_prop == 3) {
        //3交换位置
        cc.ZL.animMgr.proChangePos(animal);
      } else if (gamedata.is_prop == 4) {
        //4横向
        cc.ZL.animMgr.mask.active = true;
        animal.clearType = 1;
        animal.clear();
        setTimeout(function () {
          cc.ZL.animMgr.NewFilled();
        }, comeInfo.animalClearTime * 1000);
        cc.ZL.PropMgr.propFinished(4);
      } else if (gamedata.is_prop == 5) {
        //5纵向
        cc.ZL.animMgr.mask.active = true;
        animal.clearType = 2;
        animal.clear();
        setTimeout(function () {
          cc.ZL.animMgr.NewFilled();
        }, comeInfo.animalClearTime * 1000);
        cc.ZL.PropMgr.propFinished(5);
      }
    }.bind(this));
    this.node.on(cc.Node.EventType.TOUCH_END, function (event) {
      console.log('TOUCH_END');
      console.log(gamedata);

      if (gamedata.is_prop != 0) {
        //使用道具
        return;
      }

      this.pos2 = event.getLocation();
      console.log(this.pos1, 'this.po1');
      console.log(this.pos2, 'this.pos2');

      if (this.pos1 == undefined || this.pos1 == null) {
        console.log('无法获取目标');
        return;
      }

      console.log(this.pos1.x, '无法获取目标');
      var x_dis = this.pos2.x - this.pos1.x;
      var y_dis = this.pos2.y - this.pos1.y;

      if (Math.abs(x_dis) > Math.abs(y_dis)) {
        if (x_dis > 5) {
          //向右移动
          if (this.columnNum >= 8) {
            //范围限制
            return;
          }

          var Rnode = cc.v2(this.pos.x + 1, this.pos.y);
          cc.ZL.animMgr.selectFirstAnimal(Rnode);
        } else if (x_dis < -5) {
          //向左移动
          if (this.columnNum <= 0) {
            //范围限制
            return;
          }

          var Lnode = cc.v2(this.pos.x - 1, this.pos.y);
          cc.ZL.animMgr.selectFirstAnimal(Lnode);
        }
      } else {
        //纵向移动
        if (y_dis > 5) {
          //向上
          if (this.rowNum <= 0) {
            return;
          }

          var UPnode = cc.v2(this.pos.x, this.pos.y - 1);
          cc.ZL.animMgr.selectFirstAnimal(UPnode);
        } else if (y_dis < -5) {
          if (this.rowNum >= 8) {
            return;
          }

          var Dnode = cc.v2(this.pos.x, this.pos.y + 1);
          cc.ZL.animMgr.selectFirstAnimal(Dnode);
        }
      }

      this.pos1 = null;
      this.pos2 = null;
    }.bind(this));
    this.node.on(cc.Node.EventType.TOUCH_CANCEL, function (event) {
      console.log('TOUCH_CANCEL');

      if (gamedata.is_prop != 0) {
        //使用道具
        return;
      }

      this.pos2 = event.getLocation();

      if (this.pos1 == undefined || this.pos1 == null) {
        console.log('无法获取目标');
        return;
      }

      var x_dis = this.pos2.x - this.pos1.x;
      var y_dis = this.pos2.y - this.pos1.y;

      if (Math.abs(x_dis) > Math.abs(y_dis)) {
        if (x_dis > 5) {
          //向右移动
          if (this.columnNum >= 8) {
            //范围限制
            return;
          }

          var Rnode = cc.v2(this.pos.x + 1, this.pos.y);
          cc.ZL.animMgr.selectFirstAnimal(Rnode);
        } else if (x_dis < -5) {
          //向左移动
          if (this.columnNum <= 0) {
            //范围限制
            return;
          }

          var Lnode = cc.v2(this.pos.x - 1, this.pos.y);
          cc.ZL.animMgr.selectFirstAnimal(Lnode);
        }
      } else {
        //纵向移动
        if (y_dis > 5) {
          //向上
          if (this.rowNum <= 0) {
            return;
          }

          var UPnode = cc.v2(this.pos.x, this.pos.y - 1);
          cc.ZL.animMgr.selectFirstAnimal(UPnode);
        } else if (y_dis < -5) {
          if (this.rowNum >= 8) {
            return;
          }

          var Dnode = cc.v2(this.pos.x, this.pos.y + 1);
          cc.ZL.animMgr.selectFirstAnimal(Dnode);
        }
      }

      this.pos1 = null;
      this.pos2 = null;
    }.bind(this));
  },
  // update (dt) {},
  //将点击的像素点转变为对应的格子
  selectPos: function selectPos(pos) {
    if (pos.x < 0 || pos.x >= 720 || pos.y < 0 || pos.y >= 720) {
      return false;
    }

    var x = Math.floor(pos.x / 80);
    var y = 8 - Math.floor(pos.y / 80);
    return cc.v2(x, y);
  },
  DaoJuChui: function DaoJuChui(data) {
    this.animal = data;

    try {
      this.animal.clear();
      var preas = {
        rid: gamedata.rid,
        token: gamedata.token,
        gid: 10001,
        num: 1
      }; // TODO:先注释掉
      // UIHelp.network.httpConnect_post_async('game/xiaoxiaole/consumeProp', preas, this.onMuChuiCallBack.bind(this));

      this.onMuChuiCallBack({
        code: '200',
        message: '成功'
      });
    } catch (error) {
      utils.addTips('不可消除');
    } // animal.clear();
    // cc.ZL.PropMgr.propFinished(1);
    // cc.ZL.animMgr.NewFilled();

  },
  // 锤子执行
  onMuChuiCallBack: function onMuChuiCallBack(msg) {
    console.log('onMuChuiCallBack===>', msg);

    if (msg.code == 200) {
      // this.animal.clear();
      cc.ZL.PropMgr.propFinished(1);
      cc.ZL.animMgr.NewFilled();
    } else {
      utils.addTips(msg.message);
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9uZXdzY3JpcHRzL01haW4vVG91Y2guanMiXSwibmFtZXMiOlsicmVxdWlyZSIsImRlYnVnIiwiVUlIZWxwIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJvbkxvYWQiLCJhbmltYWwiLCJzdGFydCIsIm5vZGUiLCJvbiIsIk5vZGUiLCJFdmVudFR5cGUiLCJUT1VDSF9TVEFSVCIsImV2ZW50IiwiY29uc29sZSIsImxvZyIsInBvcyIsImdldExvY2F0aW9uIiwiY29udmVydFRvTm9kZVNwYWNlIiwic2VsZWN0UG9zIiwiWkwiLCJhbmltTWdyIiwiYW5pbWFsQXJyYXkiLCJ5IiwieCIsImdhbWVkYXRhIiwiaXNfcHJvcCIsInBvczEiLCJtdXNpY01nciIsIk15cGxheU11c2ljIiwic2VsZWN0Rmlyc3RBbmltYWwiLCJEYW9KdUNodWkiLCJjbGVhclR5cGUiLCJjbGVhciIsInNldFRpbWVvdXQiLCJOZXdGaWxsZWQiLCJjb21lSW5mbyIsImFuaW1hbENsZWFyVGltZSIsIlByb3BNZ3IiLCJwcm9wRmluaXNoZWQiLCJwcm9DaGFuZ2VQb3MiLCJtYXNrIiwiYWN0aXZlIiwiYmluZCIsIlRPVUNIX0VORCIsInBvczIiLCJ1bmRlZmluZWQiLCJ4X2RpcyIsInlfZGlzIiwiTWF0aCIsImFicyIsImNvbHVtbk51bSIsIlJub2RlIiwidjIiLCJMbm9kZSIsInJvd051bSIsIlVQbm9kZSIsIkRub2RlIiwiVE9VQ0hfQ0FOQ0VMIiwiZmxvb3IiLCJkYXRhIiwicHJlYXMiLCJyaWQiLCJ0b2tlbiIsImdpZCIsIm51bSIsIm9uTXVDaHVpQ2FsbEJhY2siLCJjb2RlIiwibWVzc2FnZSIsImVycm9yIiwidXRpbHMiLCJhZGRUaXBzIiwibXNnIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztlQUFrQkEsT0FBTyxDQUFDLFNBQUQ7SUFBakJDLGlCQUFBQTs7Z0JBQ1dELE9BQU8sQ0FBQyxXQUFEO0lBQWxCRSxtQkFBQUE7O0FBQ1JD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dE5JO0FBd05MO0FBQ0FMLEVBQUFBLGdCQXpOSyw0QkF5TllNLEdBek5aLEVBeU5pQjtBQUNsQjFELElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLHNCQUFaLEVBQW9DeUQsR0FBcEM7O0FBQ0EsUUFBSUEsR0FBRyxDQUFDTCxJQUFKLElBQVksR0FBaEIsRUFBcUI7QUFDakI7QUFDQWxFLE1BQUFBLEVBQUUsQ0FBQ21CLEVBQUgsQ0FBTWtCLE9BQU4sQ0FBY0MsWUFBZCxDQUEyQixDQUEzQjtBQUNBdEMsTUFBQUEsRUFBRSxDQUFDbUIsRUFBSCxDQUFNQyxPQUFOLENBQWNjLFNBQWQ7QUFDSCxLQUpELE1BSU87QUFDSG1DLE1BQUFBLEtBQUssQ0FBQ0MsT0FBTixDQUFjQyxHQUFHLENBQUNKLE9BQWxCO0FBQ0g7QUFDSjtBQWxPSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IGRlYnVnIH0gPSByZXF1aXJlKCdjb25zb2xlJyk7XHJcbmNvbnN0IHsgVUlIZWxwIH0gPSByZXF1aXJlKCcuLi9VSUhlbHAnKTtcclxuY2MuQ2xhc3Moe1xyXG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxyXG5cclxuICAgIHByb3BlcnRpZXM6IHt9LFxyXG5cclxuICAgIC8vIExJRkUtQ1lDTEUgQ0FMTEJBQ0tTOlxyXG5cclxuICAgIG9uTG9hZCgpIHtcclxuICAgICAgICB0aGlzLmFuaW1hbCA9IG51bGw7XHJcbiAgICB9LFxyXG5cclxuICAgIHN0YXJ0KCkge1xyXG4gICAgICAgIHRoaXMubm9kZS5vbihcclxuICAgICAgICAgICAgY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfU1RBUlQsXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1RPVUNIX1NUQVJUJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBvcyA9IGV2ZW50LmdldExvY2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnBvcywgJ3RoaXMucG9zJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBvcyA9IHRoaXMubm9kZS5jb252ZXJ0VG9Ob2RlU3BhY2UodGhpcy5wb3MpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wb3MgPSB0aGlzLnNlbGVjdFBvcyh0aGlzLnBvcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy5wb3MsICd0aGlzLnBvcycpO1xyXG4gICAgICAgICAgICAgICAgbGV0IGFuaW1hbCA9IGNjLlpMLmFuaW1NZ3IuYW5pbWFsQXJyYXlbdGhpcy5wb3MueV1bdGhpcy5wb3MueF07XHJcbiAgICAgICAgICAgICAgICBpZiAoZ2FtZWRhdGEuaXNfcHJvcCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy/mma7pgJrmk43kvZxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBvczEgPSBldmVudC5nZXRMb2NhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNjLlpMLm11c2ljTWdyLk15cGxheU11c2ljKDAsIGZhbHNlKTsgLy/mkq3mlL7ngrnlh7vpn7PmlYhcclxuICAgICAgICAgICAgICAgICAgICBjYy5aTC5hbmltTWdyLnNlbGVjdEZpcnN0QW5pbWFsKHRoaXMucG9zKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZ2FtZWRhdGEuaXNfcHJvcCA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8x5bCP5pyo5qeMXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5EYW9KdUNodWkoYW5pbWFsKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBhbmltYWwuY2xlYXIoKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjYy5aTC5Qcm9wTWdyLnByb3BGaW5pc2hlZCgxKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjYy5aTC5hbmltTWdyLk5ld0ZpbGxlZCgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChnYW1lZGF0YS5pc19wcm9wID09IDIpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLzLniIblvLlcclxuICAgICAgICAgICAgICAgICAgICBhbmltYWwuY2xlYXJUeXBlID0gMztcclxuICAgICAgICAgICAgICAgICAgICBhbmltYWwuY2xlYXIoKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2MuWkwuYW5pbU1nci5OZXdGaWxsZWQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCBjb21lSW5mby5hbmltYWxDbGVhclRpbWUgKiAxMDAwKTtcclxuICAgICAgICAgICAgICAgICAgICBjYy5aTC5Qcm9wTWdyLnByb3BGaW5pc2hlZCgyKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZ2FtZWRhdGEuaXNfcHJvcCA9PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8z5Lqk5o2i5L2N572uXHJcbiAgICAgICAgICAgICAgICAgICAgY2MuWkwuYW5pbU1nci5wcm9DaGFuZ2VQb3MoYW5pbWFsKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZ2FtZWRhdGEuaXNfcHJvcCA9PSA0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy805qiq5ZCRXHJcbiAgICAgICAgICAgICAgICAgICAgY2MuWkwuYW5pbU1nci5tYXNrLmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5pbWFsLmNsZWFyVHlwZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5pbWFsLmNsZWFyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLlpMLmFuaW1NZ3IuTmV3RmlsbGVkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgY29tZUluZm8uYW5pbWFsQ2xlYXJUaW1lICogMTAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2MuWkwuUHJvcE1nci5wcm9wRmluaXNoZWQoNCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGdhbWVkYXRhLmlzX3Byb3AgPT0gNSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vNee6teWQkVxyXG4gICAgICAgICAgICAgICAgICAgIGNjLlpMLmFuaW1NZ3IubWFzay5hY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGFuaW1hbC5jbGVhclR5cGUgPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgIGFuaW1hbC5jbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5aTC5hbmltTWdyLk5ld0ZpbGxlZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIGNvbWVJbmZvLmFuaW1hbENsZWFyVGltZSAqIDEwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIGNjLlpMLlByb3BNZ3IucHJvcEZpbmlzaGVkKDUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LmJpbmQodGhpcylcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMubm9kZS5vbihcclxuICAgICAgICAgICAgY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfRU5ELFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUT1VDSF9FTkQnKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGdhbWVkYXRhKTtcclxuICAgICAgICAgICAgICAgIGlmIChnYW1lZGF0YS5pc19wcm9wICE9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAvL+S9v+eUqOmBk+WFt1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMucG9zMiA9IGV2ZW50LmdldExvY2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnBvczEsICd0aGlzLnBvMScpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy5wb3MyLCAndGhpcy5wb3MyJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wb3MxID09IHVuZGVmaW5lZCB8fCB0aGlzLnBvczEgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfml6Dms5Xojrflj5bnm67moIcnKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnBvczEueCwgJ+aXoOazleiOt+WPluebruaghycpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHhfZGlzID0gdGhpcy5wb3MyLnggLSB0aGlzLnBvczEueDtcclxuICAgICAgICAgICAgICAgIGxldCB5X2RpcyA9IHRoaXMucG9zMi55IC0gdGhpcy5wb3MxLnk7XHJcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMoeF9kaXMpID4gTWF0aC5hYnMoeV9kaXMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHhfZGlzID4gNSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL+WQkeWPs+enu+WKqFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb2x1bW5OdW0gPj0gOCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/ojIPlm7TpmZDliLZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgUm5vZGUgPSBjYy52Mih0aGlzLnBvcy54ICsgMSwgdGhpcy5wb3MueSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLlpMLmFuaW1NZ3Iuc2VsZWN0Rmlyc3RBbmltYWwoUm5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoeF9kaXMgPCAtNSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL+WQkeW3puenu+WKqFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb2x1bW5OdW0gPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/ojIPlm7TpmZDliLZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgTG5vZGUgPSBjYy52Mih0aGlzLnBvcy54IC0gMSwgdGhpcy5wb3MueSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLlpMLmFuaW1NZ3Iuc2VsZWN0Rmlyc3RBbmltYWwoTG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy/nurXlkJHnp7vliqhcclxuICAgICAgICAgICAgICAgICAgICBpZiAoeV9kaXMgPiA1KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8v5ZCR5LiKXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJvd051bSA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIFVQbm9kZSA9IGNjLnYyKHRoaXMucG9zLngsIHRoaXMucG9zLnkgLSAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2MuWkwuYW5pbU1nci5zZWxlY3RGaXJzdEFuaW1hbChVUG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoeV9kaXMgPCAtNSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yb3dOdW0gPj0gOCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBEbm9kZSA9IGNjLnYyKHRoaXMucG9zLngsIHRoaXMucG9zLnkgKyAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2MuWkwuYW5pbU1nci5zZWxlY3RGaXJzdEFuaW1hbChEbm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5wb3MxID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHRoaXMucG9zMiA9IG51bGw7XHJcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9uKFxyXG4gICAgICAgICAgICBjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9DQU5DRUwsXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1RPVUNIX0NBTkNFTCcpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGdhbWVkYXRhLmlzX3Byb3AgIT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8v5L2/55So6YGT5YW3XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5wb3MyID0gZXZlbnQuZ2V0TG9jYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnBvczEgPT0gdW5kZWZpbmVkIHx8IHRoaXMucG9zMSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+aXoOazleiOt+WPluebruaghycpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGxldCB4X2RpcyA9IHRoaXMucG9zMi54IC0gdGhpcy5wb3MxLng7XHJcbiAgICAgICAgICAgICAgICBsZXQgeV9kaXMgPSB0aGlzLnBvczIueSAtIHRoaXMucG9zMS55O1xyXG4gICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHhfZGlzKSA+IE1hdGguYWJzKHlfZGlzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh4X2RpcyA+IDUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy/lkJHlj7Pnp7vliqhcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uTnVtID49IDgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v6IyD5Zu06ZmQ5Yi2XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IFJub2RlID0gY2MudjIodGhpcy5wb3MueCArIDEsIHRoaXMucG9zLnkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5aTC5hbmltTWdyLnNlbGVjdEZpcnN0QW5pbWFsKFJub2RlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHhfZGlzIDwgLTUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy/lkJHlt6bnp7vliqhcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uTnVtIDw9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v6IyD5Zu06ZmQ5Yi2XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIExub2RlID0gY2MudjIodGhpcy5wb3MueCAtIDEsIHRoaXMucG9zLnkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5aTC5hbmltTWdyLnNlbGVjdEZpcnN0QW5pbWFsKExub2RlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8v57q15ZCR56e75YqoXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHlfZGlzID4gNSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL+WQkeS4ilxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yb3dOdW0gPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBVUG5vZGUgPSBjYy52Mih0aGlzLnBvcy54LCB0aGlzLnBvcy55IC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLlpMLmFuaW1NZ3Iuc2VsZWN0Rmlyc3RBbmltYWwoVVBub2RlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHlfZGlzIDwgLTUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucm93TnVtID49IDgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgRG5vZGUgPSBjYy52Mih0aGlzLnBvcy54LCB0aGlzLnBvcy55ICsgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLlpMLmFuaW1NZ3Iuc2VsZWN0Rmlyc3RBbmltYWwoRG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMucG9zMSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBvczIgPSBudWxsO1xyXG4gICAgICAgICAgICB9LmJpbmQodGhpcylcclxuICAgICAgICApO1xyXG4gICAgfSxcclxuXHJcbiAgICAvLyB1cGRhdGUgKGR0KSB7fSxcclxuICAgIC8v5bCG54K55Ye755qE5YOP57Sg54K56L2s5Y+Y5Li65a+55bqU55qE5qC85a2QXHJcbiAgICBzZWxlY3RQb3MocG9zKSB7XHJcbiAgICAgICAgaWYgKHBvcy54IDwgMCB8fCBwb3MueCA+PSA3MjAgfHwgcG9zLnkgPCAwIHx8IHBvcy55ID49IDcyMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciB4ID0gTWF0aC5mbG9vcihwb3MueCAvIDgwKTtcclxuICAgICAgICB2YXIgeSA9IDggLSBNYXRoLmZsb29yKHBvcy55IC8gODApO1xyXG4gICAgICAgIHJldHVybiBjYy52Mih4LCB5KTtcclxuICAgIH0sXHJcblxyXG4gICAgRGFvSnVDaHVpKGRhdGEpIHtcclxuICAgICAgICB0aGlzLmFuaW1hbCA9IGRhdGE7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgdGhpcy5hbmltYWwuY2xlYXIoKTtcclxuICAgICAgICAgICAgbGV0IHByZWFzID0ge1xyXG4gICAgICAgICAgICAgICAgcmlkOiBnYW1lZGF0YS5yaWQsXHJcbiAgICAgICAgICAgICAgICB0b2tlbjogZ2FtZWRhdGEudG9rZW4sXHJcbiAgICAgICAgICAgICAgICBnaWQ6IDEwMDAxLFxyXG4gICAgICAgICAgICAgICAgbnVtOiAxLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAvLyBUT0RPOuWFiOazqOmHiuaOiVxyXG4gICAgICAgICAgICAvLyBVSUhlbHAubmV0d29yay5odHRwQ29ubmVjdF9wb3N0X2FzeW5jKCdnYW1lL3hpYW94aWFvbGUvY29uc3VtZVByb3AnLCBwcmVhcywgdGhpcy5vbk11Q2h1aUNhbGxCYWNrLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICB0aGlzLm9uTXVDaHVpQ2FsbEJhY2soe1xyXG4gICAgICAgICAgICAgICAgY29kZTogJzIwMCcsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAn5oiQ5YqfJyxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgdXRpbHMuYWRkVGlwcygn5LiN5Y+v5raI6ZmkJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBhbmltYWwuY2xlYXIoKTtcclxuICAgICAgICAvLyBjYy5aTC5Qcm9wTWdyLnByb3BGaW5pc2hlZCgxKTtcclxuICAgICAgICAvLyBjYy5aTC5hbmltTWdyLk5ld0ZpbGxlZCgpO1xyXG4gICAgfSxcclxuXHJcbiAgICAvLyDplKTlrZDmiafooYxcclxuICAgIG9uTXVDaHVpQ2FsbEJhY2sobXNnKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ29uTXVDaHVpQ2FsbEJhY2s9PT0+JywgbXNnKTtcclxuICAgICAgICBpZiAobXNnLmNvZGUgPT0gMjAwKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuYW5pbWFsLmNsZWFyKCk7XHJcbiAgICAgICAgICAgIGNjLlpMLlByb3BNZ3IucHJvcEZpbmlzaGVkKDEpO1xyXG4gICAgICAgICAgICBjYy5aTC5hbmltTWdyLk5ld0ZpbGxlZCgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHV0aWxzLmFkZFRpcHMobXNnLm1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbn0pO1xyXG4iXX0=