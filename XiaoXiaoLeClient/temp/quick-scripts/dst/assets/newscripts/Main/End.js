
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/newscripts/Main/End.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '5c6bfZFrUxNG6xn4wYFrmuR', 'End');
// newscripts/Main/End.js

"use strict";

var com = require('Common');

var _require = require('../UIHelp'),
    UIHelp = _require.UIHelp;

cc.Class({
  "extends": cc.Component,
  properties: {
    mask: cc.Node,
    lab_num: cc.Node
  },
  onLoad: function onLoad() {
    this.num = 0;
  },
  start: function start() {},
  // update (dt) {},
  InitView: function InitView(msg) {
    this.num = Number(msg);
    this.lab_num.getComponent(cc.Label).string = msg;
    this.node.runAction(cc.scaleTo(0.2, 1, 1));
    setTimeout(function () {
      if (this.node) {
        this.mask.opacity = 100;
      }
    }.bind(this), 300);
  },
  //看视频加5步
  AddFive: function AddFive() {
    com.WxShare();
    setTimeout(function () {
      if (comeInfo.is_share) {
        if (this.node) {
          cc.ZL.animMgr.mask.active = false;
          cc.ZL.musicMgr.MyplayMusic(0, false);
          cc.ZL.UIMgr.AddFiveStep();
          this.mask.opacity = 1;
          this.node.runAction(cc.scaleTo(0.2, 0, 0));
          setTimeout(function () {
            if (this.node) {
              this.node.destroy();
            }
          }.bind(this), 300);
          comeInfo.is_share = false;
        }
      }
    }.bind(this), 3500);
  },
  //金币加2步
  AddTwo: function AddTwo() {
    if (gamedata.gold > 20) {
      if (this.node) {
        var preas = {
          rid: gamedata.rid,
          token: gamedata.token,
          gid: 10004,
          num: 1
        };
        console.log('金币加两步'); // TODO:先注释掉

        this.consumePropCallBack({
          code: '200'
        }); // UIHelp.network.httpConnect_post_async(
        //     'game/xiaoxiaole/consumeProp',
        //     preas,
        //     this.consumePropCallBack.bind(this)
        // );
        //     cc.ZL.animMgr.mask.active=false;
        //     gamedata.gold-=20;
        //     gamedata.bc_gold();
        //     cc.ZL.musicMgr.MyplayMusic(0,false);
        //     cc.ZL.UIMgr.AddTwoStep();
        //     this.mask.opacity=1;
        //     this.node.runAction(cc.scaleTo(0.2,0,0));
        //     setTimeout(function(){
        //         if(this.node){
        //             this.node.destroy();
        //         }
        //     }.bind(this),300);
      }
    }
  },
  consumePropCallBack: function consumePropCallBack(msg) {
    console.log('金币加两部===>', msg);

    if (msg.code == 200) {
      cc.ZL.animMgr.mask.active = false;
      gamedata.gold -= this.num;
      gamedata.bc_gold();
      cc.ZL.musicMgr.MyplayMusic(0, false);
      cc.ZL.UIMgr.AddTwoStep();
      this.mask.opacity = 1;
      this.node.runAction(cc.scaleTo(0.2, 0, 0));
      setTimeout(function () {
        if (this.node) {
          this.node.destroy();
        }
      }.bind(this), 300);
    } else {
      utils.addTips(msg.message);
    }
  },
  //重玩本关
  Replay: function Replay(event) {
    this.node.getChildByName('again').getComponent(cc.Button).interactable = false;

    if (gamedata.energy >= 5) {
      var preas = {
        rid: gamedata.rid,
        token: gamedata.token,
        level: lvdata.lvl
      };
      UIHelp.network.httpSend('game/xiaoxiaole/playGame', preas, this.playGameCall.bind(this));
    } else {
      utils.addTips('体力不足');
      cc.director.loadScene('newLevel');
    } // cc.ZL.musicMgr.MyplayMusic(0, false);
    // if (gamedata.energy >= 5) {
    //     gamedata.energy -= 5;
    //     gamedata.bc_energy();
    //     cc.director.loadScene("NewMain");
    // } else {
    //     cc.director.loadScene("newLevel");
    //     // utils.addTips('体力不足');
    // }

  },
  playGameCall: function playGameCall(msg) {
    console.log('playgame===>', msg);

    if (msg.code == 200) {
      gamedata.game_code = msg.data.game_code; //当前金币数量

      gamedata.gold = Number(msg.data.coin); //当前精力

      gamedata.energy = Number(msg.data.energy);
      cc.ZL.musicMgr.MyplayMusic(0, false);
      cc.director.loadScene('NewMain');
    } else {
      utils.addTips(msg.message);
      this.node.getChildByName('again').getComponent(cc.Button).interactable = true;
    }
  },
  Close: function Close() {
    this.node.getChildByName('again').getComponent(cc.Button).interactable = false;
    cc.ZL.musicMgr.MyplayMusic(0, false);
    cc.director.loadScene('newLevel');
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9uZXdzY3JpcHRzL01haW4vRW5kLmpzIl0sIm5hbWVzIjpbImNvbSIsInJlcXVpcmUiLCJVSUhlbHAiLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsIm1hc2siLCJOb2RlIiwibGFiX251bSIsIm9uTG9hZCIsIm51bSIsInN0YXJ0IiwiSW5pdFZpZXciLCJtc2ciLCJOdW1iZXIiLCJnZXRDb21wb25lbnQiLCJMYWJlbCIsInN0cmluZyIsIm5vZGUiLCJydW5BY3Rpb24iLCJzY2FsZVRvIiwic2V0VGltZW91dCIsIm9wYWNpdHkiLCJiaW5kIiwiQWRkRml2ZSIsIld4U2hhcmUiLCJjb21lSW5mbyIsImlzX3NoYXJlIiwiWkwiLCJhbmltTWdyIiwiYWN0aXZlIiwibXVzaWNNZ3IiLCJNeXBsYXlNdXNpYyIsIlVJTWdyIiwiQWRkRml2ZVN0ZXAiLCJkZXN0cm95IiwiQWRkVHdvIiwiZ2FtZWRhdGEiLCJnb2xkIiwicHJlYXMiLCJyaWQiLCJ0b2tlbiIsImdpZCIsImNvbnNvbGUiLCJsb2ciLCJjb25zdW1lUHJvcENhbGxCYWNrIiwiY29kZSIsImJjX2dvbGQiLCJBZGRUd29TdGVwIiwidXRpbHMiLCJhZGRUaXBzIiwibWVzc2FnZSIsIlJlcGxheSIsImV2ZW50IiwiZ2V0Q2hpbGRCeU5hbWUiLCJCdXR0b24iLCJpbnRlcmFjdGFibGUiLCJlbmVyZ3kiLCJsZXZlbCIsImx2ZGF0YSIsImx2bCIsIm5ldHdvcmsiLCJodHRwU2VuZCIsInBsYXlHYW1lQ2FsbCIsImRpcmVjdG9yIiwibG9hZFNjZW5lIiwiZ2FtZV9jb2RlIiwiZGF0YSIsImNvaW4iLCJDbG9zZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxHQUFHLEdBQUdDLE9BQU8sQ0FBQyxRQUFELENBQWpCOztlQUNtQkEsT0FBTyxDQUFDLFdBQUQ7SUFBbEJDLGtCQUFBQTs7QUFDUkMsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDTCxhQUFTRCxF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QVEsQ0FBQ29CLE1BQVQsR0FBa0IzQyxNQUFNLENBQUNELEdBQUcsQ0FBQ3NELElBQUosQ0FBU1YsTUFBVixDQUF4QjtBQUNBdkQsTUFBQUEsRUFBRSxDQUFDMEIsRUFBSCxDQUFNRyxRQUFOLENBQWVDLFdBQWYsQ0FBMkIsQ0FBM0IsRUFBOEIsS0FBOUI7QUFDQTlCLE1BQUFBLEVBQUUsQ0FBQzhELFFBQUgsQ0FBWUMsU0FBWixDQUFzQixTQUF0QjtBQUNILEtBUkQsTUFRTztBQUNIaEIsTUFBQUEsS0FBSyxDQUFDQyxPQUFOLENBQWNyQyxHQUFHLENBQUNzQyxPQUFsQjtBQUNBLFdBQUtqQyxJQUFMLENBQVVvQyxjQUFWLENBQXlCLE9BQXpCLEVBQWtDdkMsWUFBbEMsQ0FBK0NiLEVBQUUsQ0FBQ3FELE1BQWxELEVBQTBEQyxZQUExRCxHQUF5RSxJQUF6RTtBQUNIO0FBQ0osR0ExSkk7QUEySkxhLEVBQUFBLEtBM0pLLG1CQTJKRztBQUNKLFNBQUtuRCxJQUFMLENBQVVvQyxjQUFWLENBQXlCLE9BQXpCLEVBQWtDdkMsWUFBbEMsQ0FBK0NiLEVBQUUsQ0FBQ3FELE1BQWxELEVBQTBEQyxZQUExRCxHQUF5RSxLQUF6RTtBQUNBdEQsSUFBQUEsRUFBRSxDQUFDMEIsRUFBSCxDQUFNRyxRQUFOLENBQWVDLFdBQWYsQ0FBMkIsQ0FBM0IsRUFBOEIsS0FBOUI7QUFDQTlCLElBQUFBLEVBQUUsQ0FBQzhELFFBQUgsQ0FBWUMsU0FBWixDQUFzQixVQUF0QjtBQUNIO0FBL0pJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBjb20gPSByZXF1aXJlKCdDb21tb24nKTtcclxuY29uc3QgeyBVSUhlbHAgfSA9IHJlcXVpcmUoJy4uL1VJSGVscCcpO1xyXG5jYy5DbGFzcyh7XHJcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXHJcblxyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIG1hc2s6IGNjLk5vZGUsXHJcbiAgICAgICAgbGFiX251bTogY2MuTm9kZSxcclxuICAgIH0sXHJcblxyXG4gICAgb25Mb2FkKCkge1xyXG4gICAgICAgIHRoaXMubnVtID0gMDtcclxuICAgIH0sXHJcblxyXG4gICAgc3RhcnQoKSB7fSxcclxuXHJcbiAgICAvLyB1cGRhdGUgKGR0KSB7fSxcclxuICAgIEluaXRWaWV3KG1zZykge1xyXG4gICAgICAgIHRoaXMubnVtID0gTnVtYmVyKG1zZyk7XHJcbiAgICAgICAgdGhpcy5sYWJfbnVtLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gbXNnO1xyXG4gICAgICAgIHRoaXMubm9kZS5ydW5BY3Rpb24oY2Muc2NhbGVUbygwLjIsIDEsIDEpKTtcclxuICAgICAgICBzZXRUaW1lb3V0KFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ub2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXNrLm9wYWNpdHkgPSAxMDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSxcclxuICAgICAgICAgICAgMzAwXHJcbiAgICAgICAgKTtcclxuICAgIH0sXHJcbiAgICAvL+eci+inhumikeWKoDXmraVcclxuICAgIEFkZEZpdmUoKSB7XHJcbiAgICAgICAgY29tLld4U2hhcmUoKTtcclxuICAgICAgICBzZXRUaW1lb3V0KFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29tZUluZm8uaXNfc2hhcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ub2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLlpMLmFuaW1NZ3IubWFzay5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2MuWkwubXVzaWNNZ3IuTXlwbGF5TXVzaWMoMCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5aTC5VSU1nci5BZGRGaXZlU3RlcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1hc2sub3BhY2l0eSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZS5ydW5BY3Rpb24oY2Muc2NhbGVUbygwLjIsIDAsIDApKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ub2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZS5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgMzAwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbWVJbmZvLmlzX3NoYXJlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LmJpbmQodGhpcyksXHJcbiAgICAgICAgICAgIDM1MDBcclxuICAgICAgICApO1xyXG4gICAgfSxcclxuICAgIC8v6YeR5biB5YqgMuatpVxyXG4gICAgQWRkVHdvKCkge1xyXG4gICAgICAgIGlmIChnYW1lZGF0YS5nb2xkID4gMjApIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMubm9kZSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHByZWFzID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJpZDogZ2FtZWRhdGEucmlkLFxyXG4gICAgICAgICAgICAgICAgICAgIHRva2VuOiBnYW1lZGF0YS50b2tlbixcclxuICAgICAgICAgICAgICAgICAgICBnaWQ6IDEwMDA0LFxyXG4gICAgICAgICAgICAgICAgICAgIG51bTogMSxcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn6YeR5biB5Yqg5Lik5q2lJyk7XHJcbiAgICAgICAgICAgICAgICAvLyBUT0RPOuWFiOazqOmHiuaOiVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jb25zdW1lUHJvcENhbGxCYWNrKHtcclxuICAgICAgICAgICAgICAgICAgICBjb2RlOiAnMjAwJyxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgLy8gVUlIZWxwLm5ldHdvcmsuaHR0cENvbm5lY3RfcG9zdF9hc3luYyhcclxuICAgICAgICAgICAgICAgIC8vICAgICAnZ2FtZS94aWFveGlhb2xlL2NvbnN1bWVQcm9wJyxcclxuICAgICAgICAgICAgICAgIC8vICAgICBwcmVhcyxcclxuICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLmNvbnN1bWVQcm9wQ2FsbEJhY2suYmluZCh0aGlzKVxyXG4gICAgICAgICAgICAgICAgLy8gKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgY2MuWkwuYW5pbU1nci5tYXNrLmFjdGl2ZT1mYWxzZTtcclxuICAgICAgICAgICAgICAgIC8vICAgICBnYW1lZGF0YS5nb2xkLT0yMDtcclxuICAgICAgICAgICAgICAgIC8vICAgICBnYW1lZGF0YS5iY19nb2xkKCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgY2MuWkwubXVzaWNNZ3IuTXlwbGF5TXVzaWMoMCxmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgY2MuWkwuVUlNZ3IuQWRkVHdvU3RlcCgpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIHRoaXMubWFzay5vcGFjaXR5PTE7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5ub2RlLnJ1bkFjdGlvbihjYy5zY2FsZVRvKDAuMiwwLDApKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIGlmKHRoaXMubm9kZSl7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICB0aGlzLm5vZGUuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgfS5iaW5kKHRoaXMpLDMwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIGNvbnN1bWVQcm9wQ2FsbEJhY2sobXNnKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ+mHkeW4geWKoOS4pOmDqD09PT4nLCBtc2cpO1xyXG4gICAgICAgIGlmIChtc2cuY29kZSA9PSAyMDApIHtcclxuICAgICAgICAgICAgY2MuWkwuYW5pbU1nci5tYXNrLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBnYW1lZGF0YS5nb2xkIC09IHRoaXMubnVtO1xyXG4gICAgICAgICAgICBnYW1lZGF0YS5iY19nb2xkKCk7XHJcbiAgICAgICAgICAgIGNjLlpMLm11c2ljTWdyLk15cGxheU11c2ljKDAsIGZhbHNlKTtcclxuICAgICAgICAgICAgY2MuWkwuVUlNZ3IuQWRkVHdvU3RlcCgpO1xyXG4gICAgICAgICAgICB0aGlzLm1hc2sub3BhY2l0eSA9IDE7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5ydW5BY3Rpb24oY2Muc2NhbGVUbygwLjIsIDAsIDApKTtcclxuICAgICAgICAgICAgc2V0VGltZW91dChcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ub2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZS5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLFxyXG4gICAgICAgICAgICAgICAgMzAwXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdXRpbHMuYWRkVGlwcyhtc2cubWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICAvL+mHjeeOqeacrOWFs1xyXG4gICAgUmVwbGF5KGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5ub2RlLmdldENoaWxkQnlOYW1lKCdhZ2FpbicpLmdldENvbXBvbmVudChjYy5CdXR0b24pLmludGVyYWN0YWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIGlmIChnYW1lZGF0YS5lbmVyZ3kgPj0gNSkge1xyXG4gICAgICAgICAgICBsZXQgcHJlYXMgPSB7XHJcbiAgICAgICAgICAgICAgICByaWQ6IGdhbWVkYXRhLnJpZCxcclxuICAgICAgICAgICAgICAgIHRva2VuOiBnYW1lZGF0YS50b2tlbixcclxuICAgICAgICAgICAgICAgIGxldmVsOiBsdmRhdGEubHZsLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBVSUhlbHAubmV0d29yay5odHRwU2VuZCgnZ2FtZS94aWFveGlhb2xlL3BsYXlHYW1lJywgcHJlYXMsIHRoaXMucGxheUdhbWVDYWxsLmJpbmQodGhpcykpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHV0aWxzLmFkZFRpcHMoJ+S9k+WKm+S4jei2sycpO1xyXG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5sb2FkU2NlbmUoJ25ld0xldmVsJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBjYy5aTC5tdXNpY01nci5NeXBsYXlNdXNpYygwLCBmYWxzZSk7XHJcbiAgICAgICAgLy8gaWYgKGdhbWVkYXRhLmVuZXJneSA+PSA1KSB7XHJcbiAgICAgICAgLy8gICAgIGdhbWVkYXRhLmVuZXJneSAtPSA1O1xyXG4gICAgICAgIC8vICAgICBnYW1lZGF0YS5iY19lbmVyZ3koKTtcclxuICAgICAgICAvLyAgICAgY2MuZGlyZWN0b3IubG9hZFNjZW5lKFwiTmV3TWFpblwiKTtcclxuICAgICAgICAvLyB9IGVsc2Uge1xyXG4gICAgICAgIC8vICAgICBjYy5kaXJlY3Rvci5sb2FkU2NlbmUoXCJuZXdMZXZlbFwiKTtcclxuICAgICAgICAvLyAgICAgLy8gdXRpbHMuYWRkVGlwcygn5L2T5Yqb5LiN6LazJyk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgfSxcclxuICAgIHBsYXlHYW1lQ2FsbChtc2cpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygncGxheWdhbWU9PT0+JywgbXNnKTtcclxuICAgICAgICBpZiAobXNnLmNvZGUgPT0gMjAwKSB7XHJcbiAgICAgICAgICAgIGdhbWVkYXRhLmdhbWVfY29kZSA9IG1zZy5kYXRhLmdhbWVfY29kZTtcclxuICAgICAgICAgICAgLy/lvZPliY3ph5HluIHmlbDph49cclxuICAgICAgICAgICAgZ2FtZWRhdGEuZ29sZCA9IE51bWJlcihtc2cuZGF0YS5jb2luKTtcclxuICAgICAgICAgICAgLy/lvZPliY3nsr7liptcclxuICAgICAgICAgICAgZ2FtZWRhdGEuZW5lcmd5ID0gTnVtYmVyKG1zZy5kYXRhLmVuZXJneSk7XHJcbiAgICAgICAgICAgIGNjLlpMLm11c2ljTWdyLk15cGxheU11c2ljKDAsIGZhbHNlKTtcclxuICAgICAgICAgICAgY2MuZGlyZWN0b3IubG9hZFNjZW5lKCdOZXdNYWluJyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdXRpbHMuYWRkVGlwcyhtc2cubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZSgnYWdhaW4nKS5nZXRDb21wb25lbnQoY2MuQnV0dG9uKS5pbnRlcmFjdGFibGUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBDbG9zZSgpIHtcclxuICAgICAgICB0aGlzLm5vZGUuZ2V0Q2hpbGRCeU5hbWUoJ2FnYWluJykuZ2V0Q29tcG9uZW50KGNjLkJ1dHRvbikuaW50ZXJhY3RhYmxlID0gZmFsc2U7XHJcbiAgICAgICAgY2MuWkwubXVzaWNNZ3IuTXlwbGF5TXVzaWMoMCwgZmFsc2UpO1xyXG4gICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZSgnbmV3TGV2ZWwnKTtcclxuICAgIH0sXHJcbn0pO1xyXG4iXX0=