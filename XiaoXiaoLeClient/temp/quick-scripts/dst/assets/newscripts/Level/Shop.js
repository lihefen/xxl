
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/newscripts/Level/Shop.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '0e447YvCv1CyZoERgFMLGvc', 'Shop');
// newscripts/Level/Shop.js

"use strict";

var com = require('Common');

var _require = require('../UIHelp'),
    UIHelp = _require.UIHelp;

cc.Class({
  "extends": cc.Component,
  properties: {
    //金币显示框
    goldLabel: [cc.Label],
    //金币不足提示
    tip: cc.Node,
    music: {
      type: cc.AudioClip,
      "default": []
    }
  },
  onLoad: function onLoad() {
    this.node.y = 1100;
    cc.ZL.shop = this;
    this.goldShow();
    this.tip.active = false;
    this.num = 0;
  },
  onGetData: function onGetData() {
    var preas = {
      rid: gamedata.rid,
      token: gamedata.token
    }; // TODO:先注释掉

    this.getMyPropListCall({
      code: '200',
      data: [{
        gid: '10001',
        coin: '1'
      }, {
        gid: '10002',
        coin: '1'
      }, {
        gid: '10003',
        coin: '1'
      }]
    }); //UIHelp.network.httpConnect_post_async('game/xiaoxiaole/getPropList', preas, this.getMyPropListCall.bind(this));
  },
  getMyPropListCall: function getMyPropListCall(msg) {
    console.log('getMyPropList===>', msg);
    utils.HideLoading();

    if (msg.code == 200) {
      if (msg.data.length > 0) {
        for (var a = 0; a < msg.data.length; a++) {
          if (msg.data[a]['gid'] == 10001) {
            comeInfo.prop_price[1] = msg.data[a]['coin'];
            this.goldLabel[1].string = msg.data[a]['coin'];
          } else if (msg.data[a]['gid'] == 10002) {
            comeInfo.prop_price[3] = msg.data[a]['coin'];
            this.goldLabel[3].string = msg.data[a]['coin'];
          } else if (msg.data[a]['gid'] == 10003) {
            comeInfo.prop_price[4] = msg.data[a]['coin'];
            this.goldLabel[4].string = msg.data[a]['coin'];
          }
        }
      }

      this.node.runAction(cc.moveTo(0.2, 0, 0).easing(cc.easeBackOut()));
    } else {
      utils.addTips(msg.message);
    }
  },
  start: function start() {// for (let i = 1; i < this.goldLabel.length; i++) {
    //     this.goldLabel[i].string = comeInfo.prop_price[i];
    // }
  },
  //显示金币信息
  goldShow: function goldShow() {
    this.goldLabel[0].string = gamedata.gold;
  },
  // update (dt) {},
  Open: function Open() {
    if (gamedata.music) {
      cc.audioEngine.play(this.music[1], false, 1);
    }

    utils.ShowLoading();
    this.onGetData(); // this.node.runAction(cc.moveTo(0.2, 0, 0).easing(cc.easeBackOut()));
  },
  Close: function Close() {
    if (gamedata.music) {
      cc.audioEngine.play(this.music[1], false, 1);
    }

    if (cc.ZL.Level) {
      cc.ZL.Level.closeMask();
    }

    this.node.runAction(cc.moveTo(0.1, 0, 2000));
  },
  Buy: function Buy(event, num) {
    num = parseInt(num);
    this.num = num;

    if (gamedata.music) {
      cc.audioEngine.play(this.music[0], false, 1);
    }

    if (gamedata.gold < comeInfo.prop_price[num]) {
      this.tip.active = true;
      return;
    }

    var gid;

    if (num == 1) {
      gid = 10001;
    } else if (num == 3) {
      gid = 10002;
    } else if (num == 4) {
      gid = 10003;
    }

    var preas = {
      rid: gamedata.rid,
      token: gamedata.token,
      gid: gid,
      buy_num: 1
    }; // TODO:本地先注释掉
    // UIHelp.network.httpConnect_post_async('game/xiaoxiaole/buy', preas, this.buyCallBack.bind(this));

    this.buyCallBack({
      code: '200',
      data: {
        coin: 1
      },
      message: '成功'
    }); // gamedata.gold-=comeInfo.prop_price[num];
    // gamedata.bc_gold();
    // this.goldShow();
    // gamedata.prop[num] +=1;
    // gamedata.bc_prop(num);
  },
  buyCallBack: function buyCallBack(msg) {
    console.log('bug===>', msg);

    if (msg.code == 200) {
      // gamedata.gold -= comeInfo.prop_price[this.num];
      // gamedata.bc_gold();
      //当前金币数量
      gamedata.gold = Number(msg.data.coin);
      this.goldShow();

      if (this.num == 4) {
        gamedata.prop[4] += 1;
      } else {
        gamedata.prop[this.num] += 1;
      }

      gamedata.bc_prop(this.num);
    } else {
      utils.addTips(msg.message);
    }
  },
  //分享获取金币
  shareGolde: function shareGolde() {
    com.WxShare();
    setTimeout(function () {
      if (comeInfo.is_share) {
        gamedata.gold += 500;
        gamedata.bc_gold();

        if (cc.director.getScene().getName() == 'Level') {
          cc.ZL.lvMgr.showInfo();
        }

        this.goldShow();
        comeInfo.is_share = false;
      }
    }.bind(this), 3500);
  },
  CloseTIP: function CloseTIP() {
    this.tip.active = false;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9uZXdzY3JpcHRzL0xldmVsL1Nob3AuanMiXSwibmFtZXMiOlsiY29tIiwicmVxdWlyZSIsIlVJSGVscCIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwiZ29sZExhYmVsIiwiTGFiZWwiLCJ0aXAiLCJOb2RlIiwibXVzaWMiLCJ0eXBlIiwiQXVkaW9DbGlwIiwib25Mb2FkIiwibm9kZSIsInkiLCJaTCIsInNob3AiLCJnb2xkU2hvdyIsImFjdGl2ZSIsIm51bSIsIm9uR2V0RGF0YSIsInByZWFzIiwicmlkIiwiZ2FtZWRhdGEiLCJ0b2tlbiIsImdldE15UHJvcExpc3RDYWxsIiwiY29kZSIsImRhdGEiLCJnaWQiLCJjb2luIiwibXNnIiwiY29uc29sZSIsImxvZyIsInV0aWxzIiwiSGlkZUxvYWRpbmciLCJsZW5ndGgiLCJhIiwiY29tZUluZm8iLCJwcm9wX3ByaWNlIiwic3RyaW5nIiwicnVuQWN0aW9uIiwibW92ZVRvIiwiZWFzaW5nIiwiZWFzZUJhY2tPdXQiLCJhZGRUaXBzIiwibWVzc2FnZSIsInN0YXJ0IiwiZ29sZCIsIk9wZW4iLCJhdWRpb0VuZ2luZSIsInBsYXkiLCJTaG93TG9hZGluZyIsIkNsb3NlIiwiTGV2ZWwiLCJjbG9zZU1hc2siLCJCdXkiLCJldmVudCIsInBhcnNlSW50IiwiYnV5X251bSIsImJ1eUNhbGxCYWNrIiwiTnVtYmVyIiwicHJvcCIsImJjX3Byb3AiLCJzaGFyZUdvbGRlIiwiV3hTaGFyZSIsInNldFRpbWVvdXQiLCJpc19zaGFyZSIsImJjX2dvbGQiLCJkaXJlY3RvciIsImdldFNjZW5lIiwiZ2V0TmFtZSIsImx2TWdyIiwic2hvd0luZm8iLCJiaW5kIiwiQ2xvc2VUSVAiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsR0FBRyxHQUFHQyxPQUFPLENBQUMsUUFBRCxDQUFqQjs7ZUFDbUJBLE9BQU8sQ0FBQyxXQUFEO0lBQWxCQyxrQkFBQUE7O0FBQ1JDLEVB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QUNIO0FBQ0osR0E1Skk7QUE2Skw7QUFDQWtCLEVBQUFBLFVBOUpLLHdCQThKUTtBQUNUakUsSUFBQUEsR0FBRyxDQUFDa0UsT0FBSjtBQUNBQyxJQUFBQSxVQUFVLENBQ04sWUFBWTtBQUNSLFVBQUk1QixRQUFRLENBQUM2QixRQUFiLEVBQXVCO0FBQ25CM0MsUUFBQUEsUUFBUSxDQUFDd0IsSUFBVCxJQUFpQixHQUFqQjtBQUNBeEIsUUFBQUEsUUFBUSxDQUFDNEMsT0FBVDs7QUFDQSxZQUFJbEUsRUFBRSxDQUFDbUUsUUFBSCxDQUFZQyxRQUFaLEdBQXVCQyxPQUF2QixNQUFvQyxPQUF4QyxFQUFpRDtBQUM3Q3JFLFVBQUFBLEVBQUUsQ0FBQ2MsRUFBSCxDQUFNd0QsS0FBTixDQUFZQyxRQUFaO0FBQ0g7O0FBQ0QsYUFBS3ZELFFBQUw7QUFFQW9CLFFBQUFBLFFBQVEsQ0FBQzZCLFFBQVQsR0FBb0IsS0FBcEI7QUFDSDtBQUNKLEtBWEQsQ0FXRU8sSUFYRixDQVdPLElBWFAsQ0FETSxFQWFOLElBYk0sQ0FBVjtBQWVILEdBL0tJO0FBZ0xMQyxFQUFBQSxRQWhMSyxzQkFnTE07QUFDUCxTQUFLbkUsR0FBTCxDQUFTVyxNQUFULEdBQWtCLEtBQWxCO0FBQ0g7QUFsTEksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGNvbSA9IHJlcXVpcmUoJ0NvbW1vbicpO1xyXG5jb25zdCB7IFVJSGVscCB9ID0gcmVxdWlyZSgnLi4vVUlIZWxwJyk7XHJcbmNjLkNsYXNzKHtcclxuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcclxuXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgLy/ph5HluIHmmL7npLrmoYZcclxuICAgICAgICBnb2xkTGFiZWw6IFtjYy5MYWJlbF0sXHJcbiAgICAgICAgLy/ph5HluIHkuI3otrPmj5DnpLpcclxuICAgICAgICB0aXA6IGNjLk5vZGUsXHJcbiAgICAgICAgbXVzaWM6IHtcclxuICAgICAgICAgICAgdHlwZTogY2MuQXVkaW9DbGlwLFxyXG4gICAgICAgICAgICBkZWZhdWx0OiBbXSxcclxuICAgICAgICB9LFxyXG4gICAgfSxcclxuICAgIG9uTG9hZCgpIHtcclxuICAgICAgICB0aGlzLm5vZGUueSA9IDExMDA7XHJcbiAgICAgICAgY2MuWkwuc2hvcCA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5nb2xkU2hvdygpO1xyXG4gICAgICAgIHRoaXMudGlwLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMubnVtID0gMDtcclxuICAgIH0sXHJcblxyXG4gICAgb25HZXREYXRhKCkge1xyXG4gICAgICAgIGxldCBwcmVhcyA9IHtcclxuICAgICAgICAgICAgcmlkOiBnYW1lZGF0YS5yaWQsXHJcbiAgICAgICAgICAgIHRva2VuOiBnYW1lZGF0YS50b2tlbixcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8vIFRPRE865YWI5rOo6YeK5o6JXHJcbiAgICAgICAgdGhpcy5nZXRNeVByb3BMaXN0Q2FsbCh7XHJcbiAgICAgICAgICAgIGNvZGU6ICcyMDAnLFxyXG4gICAgICAgICAgICBkYXRhOiBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2lkOiAnMTAwMDEnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvaW46ICcxJyxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2lkOiAnMTAwMDInLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvaW46ICcxJyxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2lkOiAnMTAwMDMnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvaW46ICcxJyxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy9VSUhlbHAubmV0d29yay5odHRwQ29ubmVjdF9wb3N0X2FzeW5jKCdnYW1lL3hpYW94aWFvbGUvZ2V0UHJvcExpc3QnLCBwcmVhcywgdGhpcy5nZXRNeVByb3BMaXN0Q2FsbC5iaW5kKHRoaXMpKTtcclxuICAgIH0sXHJcblxyXG4gICAgZ2V0TXlQcm9wTGlzdENhbGwobXNnKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2dldE15UHJvcExpc3Q9PT0+JywgbXNnKTtcclxuICAgICAgICB1dGlscy5IaWRlTG9hZGluZygpO1xyXG4gICAgICAgIGlmIChtc2cuY29kZSA9PSAyMDApIHtcclxuICAgICAgICAgICAgaWYgKG1zZy5kYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGEgPSAwOyBhIDwgbXNnLmRhdGEubGVuZ3RoOyBhKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobXNnLmRhdGFbYV1bJ2dpZCddID09IDEwMDAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbWVJbmZvLnByb3BfcHJpY2VbMV0gPSBtc2cuZGF0YVthXVsnY29pbiddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdvbGRMYWJlbFsxXS5zdHJpbmcgPSBtc2cuZGF0YVthXVsnY29pbiddO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobXNnLmRhdGFbYV1bJ2dpZCddID09IDEwMDAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbWVJbmZvLnByb3BfcHJpY2VbM10gPSBtc2cuZGF0YVthXVsnY29pbiddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdvbGRMYWJlbFszXS5zdHJpbmcgPSBtc2cuZGF0YVthXVsnY29pbiddO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobXNnLmRhdGFbYV1bJ2dpZCddID09IDEwMDAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbWVJbmZvLnByb3BfcHJpY2VbNF0gPSBtc2cuZGF0YVthXVsnY29pbiddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdvbGRMYWJlbFs0XS5zdHJpbmcgPSBtc2cuZGF0YVthXVsnY29pbiddO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLm5vZGUucnVuQWN0aW9uKGNjLm1vdmVUbygwLjIsIDAsIDApLmVhc2luZyhjYy5lYXNlQmFja091dCgpKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdXRpbHMuYWRkVGlwcyhtc2cubWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBzdGFydCgpIHtcclxuICAgICAgICAvLyBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMuZ29sZExhYmVsLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMuZ29sZExhYmVsW2ldLnN0cmluZyA9IGNvbWVJbmZvLnByb3BfcHJpY2VbaV07XHJcbiAgICAgICAgLy8gfVxyXG4gICAgfSxcclxuICAgIC8v5pi+56S66YeR5biB5L+h5oGvXHJcbiAgICBnb2xkU2hvdygpIHtcclxuICAgICAgICB0aGlzLmdvbGRMYWJlbFswXS5zdHJpbmcgPSBnYW1lZGF0YS5nb2xkO1xyXG4gICAgfSxcclxuICAgIC8vIHVwZGF0ZSAoZHQpIHt9LFxyXG4gICAgT3BlbigpIHtcclxuICAgICAgICBpZiAoZ2FtZWRhdGEubXVzaWMpIHtcclxuICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUucGxheSh0aGlzLm11c2ljWzFdLCBmYWxzZSwgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHV0aWxzLlNob3dMb2FkaW5nKCk7XHJcbiAgICAgICAgdGhpcy5vbkdldERhdGEoKTtcclxuICAgICAgICAvLyB0aGlzLm5vZGUucnVuQWN0aW9uKGNjLm1vdmVUbygwLjIsIDAsIDApLmVhc2luZyhjYy5lYXNlQmFja091dCgpKSk7XHJcbiAgICB9LFxyXG4gICAgQ2xvc2UoKSB7XHJcbiAgICAgICAgaWYgKGdhbWVkYXRhLm11c2ljKSB7XHJcbiAgICAgICAgICAgIGNjLmF1ZGlvRW5naW5lLnBsYXkodGhpcy5tdXNpY1sxXSwgZmFsc2UsIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY2MuWkwuTGV2ZWwpIHtcclxuICAgICAgICAgICAgY2MuWkwuTGV2ZWwuY2xvc2VNYXNrKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLm5vZGUucnVuQWN0aW9uKGNjLm1vdmVUbygwLjEsIDAsIDIwMDApKTtcclxuICAgIH0sXHJcbiAgICBCdXkoZXZlbnQsIG51bSkge1xyXG4gICAgICAgIG51bSA9IHBhcnNlSW50KG51bSk7XHJcbiAgICAgICAgdGhpcy5udW0gPSBudW07XHJcbiAgICAgICAgaWYgKGdhbWVkYXRhLm11c2ljKSB7XHJcbiAgICAgICAgICAgIGNjLmF1ZGlvRW5naW5lLnBsYXkodGhpcy5tdXNpY1swXSwgZmFsc2UsIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZ2FtZWRhdGEuZ29sZCA8IGNvbWVJbmZvLnByb3BfcHJpY2VbbnVtXSkge1xyXG4gICAgICAgICAgICB0aGlzLnRpcC5hY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBnaWQ7XHJcbiAgICAgICAgaWYgKG51bSA9PSAxKSB7XHJcbiAgICAgICAgICAgIGdpZCA9IDEwMDAxO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobnVtID09IDMpIHtcclxuICAgICAgICAgICAgZ2lkID0gMTAwMDI7XHJcbiAgICAgICAgfSBlbHNlIGlmIChudW0gPT0gNCkge1xyXG4gICAgICAgICAgICBnaWQgPSAxMDAwMztcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHByZWFzID0ge1xyXG4gICAgICAgICAgICByaWQ6IGdhbWVkYXRhLnJpZCxcclxuICAgICAgICAgICAgdG9rZW46IGdhbWVkYXRhLnRva2VuLFxyXG4gICAgICAgICAgICBnaWQ6IGdpZCxcclxuICAgICAgICAgICAgYnV5X251bTogMSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8vIFRPRE865pys5Zyw5YWI5rOo6YeK5o6JXHJcbiAgICAgICAgLy8gVUlIZWxwLm5ldHdvcmsuaHR0cENvbm5lY3RfcG9zdF9hc3luYygnZ2FtZS94aWFveGlhb2xlL2J1eScsIHByZWFzLCB0aGlzLmJ1eUNhbGxCYWNrLmJpbmQodGhpcykpO1xyXG4gICAgICAgIHRoaXMuYnV5Q2FsbEJhY2soe1xyXG4gICAgICAgICAgICBjb2RlOiAnMjAwJyxcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgY29pbjogMSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ+aIkOWKnycsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gZ2FtZWRhdGEuZ29sZC09Y29tZUluZm8ucHJvcF9wcmljZVtudW1dO1xyXG4gICAgICAgIC8vIGdhbWVkYXRhLmJjX2dvbGQoKTtcclxuICAgICAgICAvLyB0aGlzLmdvbGRTaG93KCk7XHJcbiAgICAgICAgLy8gZ2FtZWRhdGEucHJvcFtudW1dICs9MTtcclxuICAgICAgICAvLyBnYW1lZGF0YS5iY19wcm9wKG51bSk7XHJcbiAgICB9LFxyXG5cclxuICAgIGJ1eUNhbGxCYWNrKG1zZykge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdidWc9PT0+JywgbXNnKTtcclxuICAgICAgICBpZiAobXNnLmNvZGUgPT0gMjAwKSB7XHJcbiAgICAgICAgICAgIC8vIGdhbWVkYXRhLmdvbGQgLT0gY29tZUluZm8ucHJvcF9wcmljZVt0aGlzLm51bV07XHJcbiAgICAgICAgICAgIC8vIGdhbWVkYXRhLmJjX2dvbGQoKTtcclxuICAgICAgICAgICAgLy/lvZPliY3ph5HluIHmlbDph49cclxuICAgICAgICAgICAgZ2FtZWRhdGEuZ29sZCA9IE51bWJlcihtc2cuZGF0YS5jb2luKTtcclxuICAgICAgICAgICAgdGhpcy5nb2xkU2hvdygpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5udW0gPT0gNCkge1xyXG4gICAgICAgICAgICAgICAgZ2FtZWRhdGEucHJvcFs0XSArPSAxO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZ2FtZWRhdGEucHJvcFt0aGlzLm51bV0gKz0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBnYW1lZGF0YS5iY19wcm9wKHRoaXMubnVtKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB1dGlscy5hZGRUaXBzKG1zZy5tZXNzYWdlKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgLy/liIbkuqvojrflj5bph5HluIFcclxuICAgIHNoYXJlR29sZGUoKSB7XHJcbiAgICAgICAgY29tLld4U2hhcmUoKTtcclxuICAgICAgICBzZXRUaW1lb3V0KFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29tZUluZm8uaXNfc2hhcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICBnYW1lZGF0YS5nb2xkICs9IDUwMDtcclxuICAgICAgICAgICAgICAgICAgICBnYW1lZGF0YS5iY19nb2xkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNjLmRpcmVjdG9yLmdldFNjZW5lKCkuZ2V0TmFtZSgpID09ICdMZXZlbCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2MuWkwubHZNZ3Iuc2hvd0luZm8oKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nb2xkU2hvdygpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb21lSW5mby5pc19zaGFyZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LmJpbmQodGhpcyksXHJcbiAgICAgICAgICAgIDM1MDBcclxuICAgICAgICApO1xyXG4gICAgfSxcclxuICAgIENsb3NlVElQKCkge1xyXG4gICAgICAgIHRoaXMudGlwLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgfSxcclxufSk7XHJcbiJdfQ==