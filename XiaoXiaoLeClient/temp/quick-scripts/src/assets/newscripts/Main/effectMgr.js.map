{"version":3,"sources":["assets/newscripts/Main/effectMgr.js"],"names":["cc","Class","Component","properties","dirPrefab","Prefab","TPrefab","effParent","Node","clearPrefab","clearTarget","roweffPrefab","boomPrefab","niao","onLoad","ZL","effMgr","clearEffPool","NodePool","i","a","instantiate","put","clearRowEffPool","start","dirEff","node","dir","angle","getComponent","Animation","play","addChild","setPosition","TEff","musicMgr","MyplayMusic","T","CreatClearEff","pos","pos1","getPosition","pos_word","parent","convertToWorldSpaceAR","pos_node","convertToNodeSpaceAR","e","size","get","x","y","spd","Math","random","cube_move","CreatRowEff","PlayMusicOnly","r","anim","sp","Skeleton","clearTracks","addAnimation","setCompleteListener","bind","CreatBoomEff","b","runAction","scaleTo","setTimeout","destroy","CratNiao"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        //方向特效的预制体\r\n        dirPrefab:cc.Prefab,\r\n        //T型特效\r\n        TPrefab:cc.Prefab,\r\n        //特效的父物体\r\n        effParent:cc.Node,\r\n        //物体消除的特效\r\n        clearPrefab:cc.Prefab,\r\n        //消除的特效要飞向的目标\r\n        clearTarget:cc.Node,\r\n        //横纵向消除动画\r\n        roweffPrefab:cc.Prefab,\r\n        //爆炸动画\r\n        boomPrefab:cc.Prefab,\r\n        //魔力鸟特效\r\n        niao:cc.Prefab,\r\n\r\n    },\r\n    onLoad () {\r\n        cc.ZL.effMgr=this;\r\n        this.clearEffPool=new cc.NodePool();\r\n        for(let i=0;i<100;i++){\r\n            let a =cc.instantiate(this.clearPrefab);\r\n            this.clearEffPool.put(a);\r\n        }\r\n\r\n        this.clearRowEffPool=new cc.NodePool();\r\n        // for(let i=0;i<20;i++){\r\n        //     let b=cc.instantiate(this.roweffPrefab);\r\n        //     this.clearRowEffPool.put(b);\r\n        // }\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    // update (dt) {},\r\n    //生成方向特效 R横向C纵向\r\n    dirEff(node,dir){\r\n        let a=cc.instantiate(this.dirPrefab);\r\n        if(dir==\"Row\"){\r\n            a.angle=90;\r\n        }else if(dir==\"Column\"){\r\n            a.angle=0;\r\n        }\r\n        a.getComponent(cc.Animation).play();\r\n        node.addChild(a);\r\n        a.setPosition(0,30);\r\n    },\r\n    //T型特效\r\n    TEff(node){\r\n        cc.ZL.musicMgr.MyplayMusic(10,false);\r\n        let T=cc.instantiate(this.TPrefab);\r\n        node.addChild(T);\r\n        T.setPosition(0,30);\r\n        T.getComponent(cc.Animation).play();\r\n    },\r\n    //生成消除特效\r\n    CreatClearEff(pos){\r\n        //生成10个小星星\r\n        let pos1=this.clearTarget.getPosition();\r\n        let pos_word=this.clearTarget.parent.convertToWorldSpaceAR(pos1);\r\n        let pos_node=this.effParent.convertToNodeSpaceAR(pos_word);\r\n        for(let i=0;i<5;i++){\r\n            let e;\r\n            if(this.clearEffPool.size()>0){\r\n                e=this.clearEffPool.get();\r\n            }else{\r\n                e=cc.instantiate(this.clearPrefab);\r\n            }\r\n            this.effParent.addChild(e);\r\n            e.setPosition(pos.x,pos.y+30);\r\n            let spd=Math.random()*600+1200;\r\n            e.getComponent(\"goldeff\").cube_move(spd,pos_node,this);\r\n        }\r\n    },\r\n    //横纵向动画特效\r\n    CreatRowEff(pos,dir){\r\n        cc.ZL.musicMgr.PlayMusicOnly(11,false);\r\n        let r;\r\n        if(this.clearRowEffPool.size()>0){\r\n            r=this.clearRowEffPool.get();\r\n        }else{\r\n            r=cc.instantiate(this.roweffPrefab);\r\n        }\r\n        this.effParent.addChild(r);\r\n        r.setPosition(pos.x,pos.y+30);\r\n        let anim=r.getComponent(sp.Skeleton);\r\n        anim.clearTracks();\r\n        if(dir==\"row\"){//纵\r\n            anim.addAnimation(0,\"width\",false,0);\r\n        }else{//横\r\n            anim.addAnimation(0,\"length\",false,0);\r\n        }\r\n        //r.runAction(cc.scaleTo(0.2,1,1.5));\r\n        anim.setCompleteListener(function(){\r\n            if(r){\r\n                this.clearRowEffPool.put(r);\r\n            }\r\n        }.bind(this));\r\n    },\r\n    //生成爆炸特效\r\n    CreatBoomEff(pos){\r\n        cc.ZL.musicMgr.MyplayMusic(12,false);\r\n        let b=cc.instantiate(this.boomPrefab);\r\n        this.effParent.addChild(b);\r\n        b.setPosition(pos.x,pos.y+30);\r\n        b.runAction(cc.scaleTo(0.2,2,2));\r\n        setTimeout(function(){\r\n            if(b){\r\n                b.destroy();\r\n            }\r\n        }.bind(this),300);\r\n    },\r\n\r\n    CratNiao(node){\r\n        let a=cc.instantiate(this.niao);\r\n        //a.getComponent(cc.Animation).play();\r\n        node.addChild(a);\r\n        a.setPosition(0,30);\r\n    }\r\n});\r\n"]}