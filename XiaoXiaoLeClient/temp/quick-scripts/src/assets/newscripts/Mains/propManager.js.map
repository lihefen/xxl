{"version":3,"sources":["assets/newscripts/Mains/propManager.js"],"names":["targetManager","require","UIHelp","cc","Class","Component","properties","pronum_label","Label","propnode","Node","music","type","AudioClip","shop","ShopPrefab","Prefab","onLoad","ZL","PropMgr","showProp","num","update","dt","i","length","string","gamedata","prop","PropBtn","target","event","musicMgr","MyplayMusic","parseInt","stopAllActions","scale","instantiate","node","parent","addChild","getComponent","Open","is_prop","currentTarget","AddStep","AnimHuan","selecteffect","preas","rid","token","gid","AnimHuanCallBack","code","message","msg","console","log","animMgr","replaceAll","changeData","utils","addTips","network","httpConnect_post_async","AddStepCallBack","bind","UIMgr","AddFiveStep","e1","scaleTo","e2","seq","sequence","rep","repeatForever","runAction","propFinished","bc_prop","playMusic","audioEngine","play"],"mappings":"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","sourceRoot":"/","sourcesContent":["var targetManager = require('targetManager');\r\nconst { UIHelp } = require('../UIHelp');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        //道具数量显示框\r\n        pronum_label: [cc.Label],\r\n        //道具节点\r\n        propnode: [cc.Node],\r\n        //音效\r\n        music: {\r\n            type: cc.AudioClip,\r\n            default: [],\r\n        },\r\n        //商店预制体\r\n        shop: null,\r\n        ShopPrefab: cc.Prefab,\r\n    },\r\n    onLoad() {\r\n        cc.ZL.PropMgr = this;\r\n        this.showProp();\r\n        this.num = 0;\r\n    },\r\n    update(dt) {\r\n        this.showProp();\r\n    },\r\n    //显示道具信息\r\n    showProp() {\r\n        for (var i = 0; i < this.pronum_label.length; i++) {\r\n            if (i == 5) {\r\n                this.pronum_label[5].string = gamedata.prop[4];\r\n            } else {\r\n                this.pronum_label[i].string = gamedata.prop[i + 1];\r\n            }\r\n        }\r\n    },\r\n    //道具点击\r\n    PropBtn(target, event) {\r\n        cc.ZL.musicMgr.MyplayMusic(0, false);\r\n        event = parseInt(event);\r\n        for (var i = 0; i < this.propnode.length; i++) {\r\n            this.propnode[i].stopAllActions();\r\n            this.propnode[i].scale = 0.7;\r\n        }\r\n        if (gamedata.prop[event] <= 0) {\r\n            if (this.shop == null) {\r\n                this.shop = cc.instantiate(this.ShopPrefab);\r\n                this.node.parent.addChild(this.shop);\r\n                //this.shop.setPosition(0,1000);\r\n            }\r\n            this.shop.getComponent('Shop').Open();\r\n            return;\r\n        }\r\n        //this.playMusic(0);\r\n        if (gamedata.is_prop == parseInt(event)) {\r\n            gamedata.is_prop = 0;\r\n            target.currentTarget.scale = 0.7;\r\n            target.currentTarget.stopAllActions();\r\n        } else {\r\n            if (parseInt(event) == 4) {\r\n                this.AddStep();\r\n                return;\r\n            } else if (parseInt(event) == 3) {\r\n                this.AnimHuan();\r\n                // cc.ZL.animMgr.replaceAll();\r\n                // this.changeData(3);\r\n                // gamedata.is_prop = 0;\r\n                return;\r\n            }\r\n            gamedata.is_prop = parseInt(event);\r\n            this.selecteffect(target.currentTarget);\r\n        }\r\n    },\r\n    AnimHuan() {\r\n        // cc.ZL.animMgr.replaceAll();\r\n        // this.changeData(3);\r\n        // gamedata.is_prop = 0;\r\n\r\n        let preas = {\r\n            rid: gamedata.rid,\r\n            token: gamedata.token,\r\n            gid: 10002,\r\n            num: 1,\r\n        };\r\n        // TODO:先注释掉\r\n        // UIHelp.network.httpConnect_post_async('game/xiaoxiaole/consumeProp', preas, this.AnimHuanCallBack.bind(this));\r\n        this.AnimHuanCallBack({\r\n            code: '200',\r\n            message: '成功',\r\n        });\r\n    },\r\n\r\n    AnimHuanCallBack(msg) {\r\n        console.log('AnimHuanCallBack===>', msg);\r\n        if (msg.code == 200) {\r\n            cc.ZL.animMgr.replaceAll();\r\n            this.changeData(3);\r\n            gamedata.is_prop = 0;\r\n        } else {\r\n            utils.addTips(msg.message);\r\n        }\r\n    },\r\n    //加五步\r\n    AddStep() {\r\n        let preas = {\r\n            rid: gamedata.rid,\r\n            token: gamedata.token,\r\n            gid: 10003,\r\n            num: 1,\r\n        };\r\n        // TODO:先注释\r\n        UIHelp.network.httpConnect_post_async('game/xiaoxiaole/consumeProp', preas, this.AddStepCallBack.bind(this));\r\n        // gamedata.is_prop = 0;\r\n        // cc.ZL.UIMgr.AddFiveStep();\r\n        // this.changeData(6);\r\n    },\r\n\r\n    AddStepCallBack(msg) {\r\n        console.log('AddStepCallBack===>', msg);\r\n        if (msg.code == 200) {\r\n            gamedata.is_prop = 0;\r\n            cc.ZL.UIMgr.AddFiveStep();\r\n            this.changeData(6);\r\n        } else {\r\n            utils.addTips(msg.message);\r\n        }\r\n    },\r\n    //选中特效\r\n    selecteffect(node) {\r\n        var e1 = cc.scaleTo(0.5, 0.8, 0.8);\r\n        var e2 = cc.scaleTo(0.5, 0.6, 0.6);\r\n        var seq = cc.sequence([e1, e2]);\r\n        var rep = cc.repeatForever(seq);\r\n        node.runAction(rep);\r\n    },\r\n    //道具使用结束\r\n    propFinished(num) {\r\n        gamedata.is_prop = 0;\r\n        //this.playMusic(0);\r\n        for (var i = 0; i < this.propnode.length; i++) {\r\n            this.propnode[i].stopAllActions();\r\n            this.propnode[i].scale = 0.7;\r\n        }\r\n        this.changeData(num);\r\n    },\r\n    //更改数据\r\n    changeData(num) {\r\n        num = parseInt(num);\r\n        this.num = num;\r\n        if (num == 6) {\r\n            gamedata.prop[4] -= 1;\r\n        } else {\r\n            gamedata.prop[num] -= 1;\r\n        }\r\n        this.pronum_label[num - 1].string = gamedata.prop[num];\r\n        gamedata.bc_prop(num);\r\n        // let gid;\r\n        // if (num == 1) {\r\n        //     gid = 10001\r\n        // } else if (num == 3) {\r\n        //     gid = 10002\r\n        // } else if (num == 6) {\r\n        //     gid = 10003\r\n        // }\r\n    },\r\n    //播放音效\r\n    playMusic(num) {\r\n        if (gamedata.music) {\r\n            cc.audioEngine.play(this.music[num], false, 1);\r\n        }\r\n    },\r\n});\r\n"]}