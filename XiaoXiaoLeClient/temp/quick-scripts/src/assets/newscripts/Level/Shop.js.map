{"version":3,"sources":["assets/newscripts/Level/Shop.js"],"names":["com","require","UIHelp","cc","Class","Component","properties","goldLabel","Label","tip","Node","music","type","AudioClip","onLoad","node","y","ZL","shop","goldShow","active","num","onGetData","preas","rid","gamedata","token","getMyPropListCall","code","data","gid","coin","msg","console","log","utils","HideLoading","length","a","comeInfo","prop_price","string","runAction","moveTo","easing","easeBackOut","addTips","message","start","gold","Open","audioEngine","play","ShowLoading","Close","Level","closeMask","Buy","event","parseInt","buy_num","buyCallBack","Number","prop","bc_prop","shareGolde","WxShare","setTimeout","is_share","bc_gold","director","getScene","getName","lvMgr","showInfo","bind","CloseTIP"],"mappings":"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","sourceRoot":"/","sourcesContent":["var com = require('Common');\r\nconst { UIHelp } = require('../UIHelp');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        //金币显示框\r\n        goldLabel: [cc.Label],\r\n        //金币不足提示\r\n        tip: cc.Node,\r\n        music: {\r\n            type: cc.AudioClip,\r\n            default: [],\r\n        },\r\n    },\r\n    onLoad() {\r\n        this.node.y = 1100;\r\n        cc.ZL.shop = this;\r\n        this.goldShow();\r\n        this.tip.active = false;\r\n        this.num = 0;\r\n    },\r\n\r\n    onGetData() {\r\n        let preas = {\r\n            rid: gamedata.rid,\r\n            token: gamedata.token,\r\n        };\r\n        // TODO:先注释掉\r\n        this.getMyPropListCall({\r\n            code: '200',\r\n            data: [\r\n                {\r\n                    gid: '10001',\r\n                    coin: '1',\r\n                },\r\n                {\r\n                    gid: '10002',\r\n                    coin: '1',\r\n                },\r\n                {\r\n                    gid: '10003',\r\n                    coin: '1',\r\n                },\r\n            ],\r\n        });\r\n        //UIHelp.network.httpConnect_post_async('game/xiaoxiaole/getPropList', preas, this.getMyPropListCall.bind(this));\r\n    },\r\n\r\n    getMyPropListCall(msg) {\r\n        console.log('getMyPropList===>', msg);\r\n        utils.HideLoading();\r\n        if (msg.code == 200) {\r\n            if (msg.data.length > 0) {\r\n                for (let a = 0; a < msg.data.length; a++) {\r\n                    if (msg.data[a]['gid'] == 10001) {\r\n                        comeInfo.prop_price[1] = msg.data[a]['coin'];\r\n                        this.goldLabel[1].string = msg.data[a]['coin'];\r\n                    } else if (msg.data[a]['gid'] == 10002) {\r\n                        comeInfo.prop_price[3] = msg.data[a]['coin'];\r\n                        this.goldLabel[3].string = msg.data[a]['coin'];\r\n                    } else if (msg.data[a]['gid'] == 10003) {\r\n                        comeInfo.prop_price[4] = msg.data[a]['coin'];\r\n                        this.goldLabel[4].string = msg.data[a]['coin'];\r\n                    }\r\n                }\r\n            }\r\n            this.node.runAction(cc.moveTo(0.2, 0, 0).easing(cc.easeBackOut()));\r\n        } else {\r\n            utils.addTips(msg.message);\r\n        }\r\n    },\r\n\r\n    start() {\r\n        // for (let i = 1; i < this.goldLabel.length; i++) {\r\n        //     this.goldLabel[i].string = comeInfo.prop_price[i];\r\n        // }\r\n    },\r\n    //显示金币信息\r\n    goldShow() {\r\n        this.goldLabel[0].string = gamedata.gold;\r\n    },\r\n    // update (dt) {},\r\n    Open() {\r\n        if (gamedata.music) {\r\n            cc.audioEngine.play(this.music[1], false, 1);\r\n        }\r\n        utils.ShowLoading();\r\n        this.onGetData();\r\n        // this.node.runAction(cc.moveTo(0.2, 0, 0).easing(cc.easeBackOut()));\r\n    },\r\n    Close() {\r\n        if (gamedata.music) {\r\n            cc.audioEngine.play(this.music[1], false, 1);\r\n        }\r\n        if (cc.ZL.Level) {\r\n            cc.ZL.Level.closeMask();\r\n        }\r\n\r\n        this.node.runAction(cc.moveTo(0.1, 0, 2000));\r\n    },\r\n    Buy(event, num) {\r\n        num = parseInt(num);\r\n        this.num = num;\r\n        if (gamedata.music) {\r\n            cc.audioEngine.play(this.music[0], false, 1);\r\n        }\r\n        if (gamedata.gold < comeInfo.prop_price[num]) {\r\n            this.tip.active = true;\r\n            return;\r\n        }\r\n        let gid;\r\n        if (num == 1) {\r\n            gid = 10001;\r\n        } else if (num == 3) {\r\n            gid = 10002;\r\n        } else if (num == 4) {\r\n            gid = 10003;\r\n        }\r\n        let preas = {\r\n            rid: gamedata.rid,\r\n            token: gamedata.token,\r\n            gid: gid,\r\n            buy_num: 1,\r\n        };\r\n        // TODO:本地先注释掉\r\n        // UIHelp.network.httpConnect_post_async('game/xiaoxiaole/buy', preas, this.buyCallBack.bind(this));\r\n        this.buyCallBack({\r\n            code: '200',\r\n            data: {\r\n                coin: 1,\r\n            },\r\n            message: '成功',\r\n        });\r\n        // gamedata.gold-=comeInfo.prop_price[num];\r\n        // gamedata.bc_gold();\r\n        // this.goldShow();\r\n        // gamedata.prop[num] +=1;\r\n        // gamedata.bc_prop(num);\r\n    },\r\n\r\n    buyCallBack(msg) {\r\n        console.log('bug===>', msg);\r\n        if (msg.code == 200) {\r\n            // gamedata.gold -= comeInfo.prop_price[this.num];\r\n            // gamedata.bc_gold();\r\n            //当前金币数量\r\n            gamedata.gold = Number(msg.data.coin);\r\n            this.goldShow();\r\n            if (this.num == 4) {\r\n                gamedata.prop[4] += 1;\r\n            } else {\r\n                gamedata.prop[this.num] += 1;\r\n            }\r\n            gamedata.bc_prop(this.num);\r\n        } else {\r\n            utils.addTips(msg.message);\r\n        }\r\n    },\r\n    //分享获取金币\r\n    shareGolde() {\r\n        com.WxShare();\r\n        setTimeout(\r\n            function () {\r\n                if (comeInfo.is_share) {\r\n                    gamedata.gold += 500;\r\n                    gamedata.bc_gold();\r\n                    if (cc.director.getScene().getName() == 'Level') {\r\n                        cc.ZL.lvMgr.showInfo();\r\n                    }\r\n                    this.goldShow();\r\n\r\n                    comeInfo.is_share = false;\r\n                }\r\n            }.bind(this),\r\n            3500\r\n        );\r\n    },\r\n    CloseTIP() {\r\n        this.tip.active = false;\r\n    },\r\n});\r\n"]}