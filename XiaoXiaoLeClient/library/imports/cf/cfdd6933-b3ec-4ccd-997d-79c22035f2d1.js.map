{"version":3,"sources":["assets/newscripts/Loading/Begin.js"],"names":["require","UIHelp","cc","Class","Component","properties","music","type","AudioClip","tipLabel","Label","pro_loading","ProgressBar","Logo","Node","onLoad","init","ZL","audioEngine","play","LogoAnim","start","anim","getComponent","sp","Skeleton","clearTracks","addAnimation","setEndListener","res","animation","name","LoadingChild","bind","self","data","roomID","token","gamedata","rid","director","loadScene","utils","addTips","error","getQueryString","login","preas","network","httpSend","loginCall","msg","console","log","code","Lv_star","Number","current_level","level_stars","gold","coin","energy","httpConnect_post_async","getMyPropListCallBack","message","length","a","gid","prop","num","preLoading","is_Loading","onProcess","completecount","totalcount","item","progress","string","Math","floor","onProcess1","preloadScene","setTimeout"],"mappings":"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","sourceRoot":"/","sourcesContent":["const { UIHelp } = require('../UIHelp');\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        music: {\r\n            type: cc.AudioClip,\r\n            default: null,\r\n        },\r\n        //文字提示框\r\n        tipLabel: [cc.Label],\r\n        //进度条\r\n        pro_loading: cc.ProgressBar,\r\n\r\n        //骨骼动画\r\n        Logo: cc.Node,\r\n    },\r\n\r\n    onLoad() {\r\n        UIHelp.init();\r\n        if ((cc.ZL = null)) {\r\n            cc.ZL = {};\r\n        }\r\n        //wx.clearStorage();\r\n        // gamedata.GetData();\r\n        cc.audioEngine.play(this.music, true, 0.3);\r\n        this.LogoAnim();\r\n\r\n        // this.LoadingChild();\r\n    },\r\n\r\n    start() {},\r\n    //播放出场动画\r\n    LogoAnim() {\r\n        let anim = this.Logo.getComponent(sp.Skeleton);\r\n        anim.clearTracks();\r\n        anim.addAnimation(0, 'start', false, 0);\r\n        anim.addAnimation(0, 'play', false, 0);\r\n        anim.addAnimation(0, 'end', false, 0);\r\n        anim.setEndListener(\r\n            function (res) {\r\n                if (res.animation.name == 'play') {\r\n                    this.LoadingChild();\r\n                }\r\n            }.bind(this)\r\n        );\r\n    },\r\n    //加载子包\r\n    LoadingChild() {\r\n        let self = this;\r\n        try {\r\n            const data = {\r\n                roomID: '1',\r\n                token: '2',\r\n            };\r\n\r\n            if (data.roomID) {\r\n                gamedata.rid = data.roomID;\r\n            }\r\n            if (data.token) {\r\n                gamedata.token = data.token;\r\n            }\r\n            cc.director.loadScene('newLevel');\r\n            if (!gamedata.rid || !gamedata.token) {\r\n                utils.addTips('参数错误');\r\n                return;\r\n            }\r\n\r\n            // winOcx.getUserData((data) => {\r\n            //     if (data.roomID) {\r\n            //         gamedata.rid = data.roomID;\r\n            //     }\r\n            //     if (data.token) {\r\n            //         gamedata.token = data.token;\r\n            //     }\r\n            //     if (!gamedata.rid || !gamedata.token) {\r\n            //         utils.addTips('参数错误');\r\n            //         return;\r\n            //     }\r\n            // });\r\n        } catch (error) {\r\n            gamedata.rid = utils.getQueryString('rid');\r\n            gamedata.token = utils.getQueryString('token');\r\n            if (!gamedata.rid || !gamedata.token) {\r\n                utils.addTips('参数错误');\r\n                return;\r\n            }\r\n            this.login();\r\n        }\r\n    },\r\n    login() {\r\n        let preas = {\r\n            rid: gamedata.rid,\r\n            token: gamedata.token,\r\n        };\r\n        UIHelp.network.httpSend('game/xiaoxiaole/getGameInfo', preas, this.loginCall.bind(this));\r\n    },\r\n    loginCall(msg) {\r\n        console.log('login==>', msg);\r\n        if (msg.code == 200) {\r\n            gamedata.Lv_star = Number(msg.data.current_level);\r\n            // gamedata.Lv_star = 74;\r\n            gamedata.level_stars = msg.data.level_stars;\r\n            //当前金币数量\r\n            gamedata.gold = Number(msg.data.coin);\r\n            //当前精力\r\n            gamedata.energy = Number(msg.data.energy);\r\n            let preas = {\r\n                rid: gamedata.rid,\r\n                token: gamedata.token,\r\n            };\r\n            UIHelp.network.httpConnect_post_async(\r\n                'game/xiaoxiaole/getMyPropList',\r\n                preas,\r\n                this.getMyPropListCallBack.bind(this)\r\n            );\r\n        } else {\r\n            utils.addTips(msg.message);\r\n        }\r\n    },\r\n\r\n    getMyPropListCallBack(msg) {\r\n        console.log('getmyPrropList====>', msg);\r\n        if (msg.code == 200) {\r\n            if (msg.data.length > 0) {\r\n                for (let a = 0; a < msg.data.length; a++) {\r\n                    if (msg.data[a].gid == 10001) {\r\n                        gamedata.prop[1] = Number(msg.data[a].num);\r\n                    } else if (msg.data[a].gid == 10002) {\r\n                        gamedata.prop[3] = Number(msg.data[a].num);\r\n                    } else if (msg.data[a].gid == 10003) {\r\n                        gamedata.prop[4] = Number(msg.data[a].num);\r\n                    }\r\n                }\r\n            }\r\n            this.preLoading();\r\n        } else {\r\n            utils.addTips(msg.message);\r\n        }\r\n    },\r\n    //预先加载资源\r\n    preLoading() {\r\n        let self = this;\r\n        // self.tipLabel[1].string = \"正在加载资源......\";\r\n        self.is_Loading = true;\r\n        let onProcess = function (completecount, totalcount, item) {\r\n            if (self.is_Loading) {\r\n                let progress = (completecount / totalcount) * 0.5;\r\n                self.tipLabel[0].string = Math.floor(progress * 100) + '%';\r\n                //console.log(progress);\r\n                self.pro_loading.progress = progress;\r\n            }\r\n        };\r\n        let onProcess1 = function (completecount, totalcount, item) {\r\n            if (self.is_Loading) {\r\n                let progress = (completecount / totalcount) * 0.5 + 0.5;\r\n                self.tipLabel[0].string = Math.floor(progress * 100) + '%';\r\n                //console.log(progress);\r\n                self.pro_loading.progress = progress;\r\n            }\r\n        };\r\n        cc.director.preloadScene('newLevel', onProcess, () => {\r\n            cc.director.preloadScene('NewMain', onProcess1, () => {\r\n                self.is_Loading = false;\r\n                setTimeout(\r\n                    function () {\r\n                        cc.director.loadScene('newLevel');\r\n                    }.bind(this),\r\n                    1000\r\n                );\r\n            });\r\n        });\r\n        // cc.loader.loadResDir(\"texture\", onProcess, function (err, assets) {\r\n        //     if (err) {\r\n        //         self.tipLabel[1].string = \"加载资源错误\";\r\n        //     } else {\r\n        //         self.is_Loading = false;\r\n        //         setTimeout(function () {\r\n        //             cc.director.loadScene(\"newLevel\");\r\n        //         }.bind(this), 1000);\r\n        //         // self.tipLabel[1].string = \"加载关卡资源.......\";\r\n        //         // cc.loader.loadResDir('levels', cc.TextAsset, (err, res) => {\r\n        //         //     if (err) {\r\n        //         //         console.log(\"load res error=\" + err);\r\n        //         //     } else {\r\n        //         //         // gamedata.Lv_star = res.length - 1;\r\n        //         //         // console.log('sdafsdfa', gamedata.Lv_star)\r\n        //         //         self.tipLabel[1].string = \"加载资源成功，正在进入游戏\";\r\n        //         //         setTimeout(function () {\r\n        //         //             cc.director.loadScene(\"newLevel\");\r\n        //         //         }.bind(this), 1000);\r\n        //         //     }\r\n        //         // })\r\n\r\n        //     }\r\n        // })\r\n    },\r\n});\r\n"]}